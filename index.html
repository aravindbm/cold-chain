<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission: Cold Chain Guardian</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #c0392b;
            --light: #ecf0f1;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 90%;
            max-width: 800px;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
        }

        h1, h2 { color: var(--primary); }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
        }

        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--danger);
            background: #fadbd8;
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* Input Forms */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 1rem;
        }

        /* Buttons */
        .btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }
        .btn:hover { background-color: #2980b9; }
        .btn-option {
            width: 100%;
            margin: 10px 0;
            text-align: left;
            background-color: white;
            color: var(--primary);
            border: 2px solid var(--light);
        }
        .btn-option:hover { border-color: var(--accent); background-color: #eaf2f8; }

        /* Screens */
        .screen { display: none; animation: fadeIn 0.5s; }
        .active { display: block; }

        /* Feedback Styles */
        .feedback-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .feedback-correct { background-color: #d4efdf; color: #145a32; border-left: 5px solid var(--success); }
        .feedback-wrong { background-color: #fadbd8; color: #7b241c; border-left: 5px solid var(--danger); }

        /* Report Table */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: var(--primary); color: white; }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .objectives {
            background: #e8f6f3;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div id="screen-login" class="screen active">
        <h1>Mission: Cold Chain Guardian</h1>
        <div class="objectives">
            <strong>Learning Objectives (CBME):</strong><br>
            1. Define the Cold Chain system.<br>
            2. Identify Cold Chain equipment functionality.<br>
            3. Classify vaccines (Live/Killed) and Diluents.<br>
            4. Demonstrate correct ILR storage positioning.<br>
            5. Interpret the Shake Test for freeze damage.
        </div>
        <div class="form-group">
            <label>Student Name</label>
            <input type="text" id="studentName" placeholder="Dr. Future">
        </div>
        <div class="form-group">
            <label>Roll Number</label>
            <input type="text" id="rollNo" placeholder="IMG-2025-001">
        </div>
        <button class="btn" onclick="startGame()">Start Simulation</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="header-bar">
            <span id="display-name">Student</span>
            <span class="timer" id="timer">00:00</span>
        </div>
        
        <div id="question-container">
            <h2 id="station-title">Station 1</h2>
            <p id="question-text" style="font-size: 1.1rem; line-height: 1.5;">Question goes here...</p>
            <div id="options-container"></div>
        </div>

        <div id="feedback-display" class="feedback-box"></div>
        <button id="next-btn" class="btn" style="display:none; margin-top:15px;" onclick="nextQuestion()">Proceed to Next Station</button>
    </div>

    <div id="screen-report" class="screen">
        <h1>Mission Report</h1>
        <p><strong>Candidate:</strong> <span id="report-name"></span> (<span id="report-roll"></span>)</p>
        <p><strong>Total Time:</strong> <span id="report-time"></span></p>
        <p><strong>Final Score:</strong> <span id="report-score"></span> / 5</p>
        
        <h3>Performance Breakdown</h3>
        <table id="report-table">
            <thead>
                <tr>
                    <th>Station</th>
                    <th>Result</th>
                    <th>Educator's Note</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <br>
        <button class="btn" onclick="location.reload()">Restart Mission</button>
    </div>

</div>

<script>
    // --- GAME DATA ---
    const stations = [
        {
            title: "Station 1: The Definition (Concepts)",
            question: "You are explaining the Cold Chain to a new staff member. Complete the definition: 'The Cold Chain is a system of storing and transporting vaccines at recommended temperatures from the ________ to the ________.'",
            options: [
                "Laboratory -> Hospital Bed",
                "Point of Manufacture -> Point of Use (Beneficiary)",
                "State Store -> Sub-center"
            ],
            correctIndex: 1,
            feedback: "Correct! The chain must remain unbroken from the factory all the way to the beneficiary's arm. A break anywhere compromises potency."
        },
        {
            title: "Station 2: The Equipment (PHC Level)",
            question: "You are at a Primary Health Center (PHC). You need to store the monthly stock of vaccines. Which equipment is the primary choice for STORAGE at the PHC?",
            options: [
                "Deep Freezer",
                "Ice Lined Refrigerator (ILR)",
                "Cold Box",
                "Domestic Refrigerator"
            ],
            correctIndex: 1,
            feedback: "Correct! The ILR is the backbone of the PHC cold chain. It maintains +2 to +8Â°C. The Deep Freezer at the PHC is mainly used for preparing ice packs."
        },
        {
            title: "Station 3: Diluent Logic",
            question: "It is Immunization Day. You are reconstituting the BCG vaccine. Which diluent must you use?",
            options: [
                "Sterile Water",
                "Phosphate Buffer Solution",
                "Normal Saline (Sodium Chloride)",
                "Distilled Water"
            ],
            correctIndex: 2,
            feedback: "Spot on. BCG uses Normal Saline. (Remember: Measles uses Sterile Water; JE uses Phosphate Buffer). Never mix them up!"
        },
        {
            title: "Station 4: ILR Positioning (The Tetris)",
            question: "You have a shipment of PENTAVALENT vaccines. Where do you place them inside the Ice Lined Refrigerator (ILR)?",
            options: [
                "In the Basket (Top part)",
                "On the Floor (Bottom part)",
                "In the Freezer component"
            ],
            correctIndex: 0,
            feedback: "Excellent. Pentavalent is a 'T-series' vaccine (Freeze Sensitive). It must be kept in the basket (Top) to avoid contact with the cold walls/bottom. The bottom is for heat-sensitive vaccines (OPV, Measles)."
        },
        {
            title: "BONUS Station: The Shake Test",
            question: "You suspect a vial of Td vaccine was frozen accidentally. You perform a Shake Test alongside a control vial. <br><br><strong>Observation:</strong> The suspect vial forms sediment FAST and the supernatant is CLEAR. The control vial settles SLOWLY and is CLOUDY.<br><br>What is your decision?",
            options: [
                "The vaccine is SAFE. Use it.",
                "The vaccine is DAMAGED. Discard it.",
                "Wait another 24 hours and re-test."
            ],
            correctIndex: 1,
            feedback: "Correct decision. If the sediment settles faster than the control and leaves a clear liquid, the lattice structure is broken by freezing. Potency is lost. Discard immediately."
        }
    ];

    // --- STATE VARIABLES ---
    let currentStation = 0;
    let score = 0;
    let startTime;
    let endTime;
    let userLog = []; // Stores { question, status, note }

    // --- DOM ELEMENTS ---
    const screens = {
        login: document.getElementById('screen-login'),
        game: document.getElementById('screen-game'),
        report: document.getElementById('screen-report')
    };
    const timerEl = document.getElementById('timer');

    // --- FUNCTIONS ---

    function showScreen(screenName) {
        Object.values(screens).forEach(s => s.classList.remove('active'));
        screens[screenName].classList.add('active');
    }

    function startGame() {
        const name = document.getElementById('studentName').value;
        const roll = document.getElementById('rollNo').value;

        if(!name || !roll) {
            alert("Please enter Name and Roll Number to proceed.");
            return;
        }

        document.getElementById('display-name').textContent = name;
        showScreen('game');
        startTime = new Date();
        setInterval(updateTimer, 1000);
        loadQuestion();
    }

    function updateTimer() {
        const now = new Date();
        const diff = Math.floor((now - startTime) / 1000);
        const min = Math.floor(diff / 60).toString().padStart(2, '0');
        const sec = (diff % 60).toString().padStart(2, '0');
        timerEl.textContent = `${min}:${sec}`;
    }

    function loadQuestion() {
        const data = stations[currentStation];
        document.getElementById('station-title').textContent = data.title;
        document.getElementById('question-text').innerHTML = data.question;
        
        const optsContainer = document.getElementById('options-container');
        optsContainer.innerHTML = ''; // Clear previous

        data.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-option';
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optsContainer.appendChild(btn);
        });

        // Reset UI
        document.getElementById('feedback-display').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        
        // Re-enable buttons
        const allBtns = document.querySelectorAll('.btn-option');
        allBtns.forEach(b => b.disabled = false);
    }

    function checkAnswer(selectedIndex, clickedBtn) {
        const data = stations[currentStation];
        const feedbackEl = document.getElementById('feedback-display');
        const allBtns = document.querySelectorAll('.btn-option');
        
        // Disable all buttons to prevent double answers
        allBtns.forEach(b => b.disabled = true);

        let isCorrect = (selectedIndex === data.correctIndex);
        
        if (isCorrect) {
            score++;
            clickedBtn.style.backgroundColor = '#d4efdf';
            clickedBtn.style.borderColor = '#27ae60';
            feedbackEl.className = 'feedback-box feedback-correct';
            feedbackEl.innerHTML = `<strong>Correct!</strong> ${data.feedback}`;
        } else {
            clickedBtn.style.backgroundColor = '#fadbd8';
            clickedBtn.style.borderColor = '#c0392b';
            feedbackEl.className = 'feedback-box feedback-wrong';
            feedbackEl.innerHTML = `<strong>Incorrect.</strong> ${data.feedback}`;
        }

        // Log result
        userLog.push({
            station: data.title,
            result: isCorrect ? "Pass" : "Needs Improvement",
            note: isCorrect ? "Competency Demonstrated" : "Review Topic"
        });

        feedbackEl.style.display = 'block';
        document.getElementById('next-btn').style.display = 'inline-block';
        
        // Change button text if it's the last question
        if(currentStation === stations.length - 1) {
            document.getElementById('next-btn').textContent = "Finish Mission & View Report";
        }
    }

    function nextQuestion() {
        if (currentStation < stations.length - 1) {
            currentStation++;
            loadQuestion();
        } else {
            finishGame();
        }
    }

    function finishGame() {
        endTime = new Date();
        const duration = Math.floor((endTime - startTime) / 1000);
        const min = Math.floor(duration / 60);
        const sec = duration % 60;
        
        // Populate Report
        document.getElementById('report-name').textContent = document.getElementById('studentName').value;
        document.getElementById('report-roll').textContent = document.getElementById('rollNo').value;
        document.getElementById('report-time').textContent = `${min} min ${sec} sec`;
        document.getElementById('report-score').textContent = score;

        const tbody = document.querySelector('#report-table tbody');
        tbody.innerHTML = '';
        
        userLog.forEach(log => {
            const row = `<tr>
                <td>${log.station}</td>
                <td style="color: ${log.result === 'Pass' ? 'green' : 'red'}"><strong>${log.result}</strong></td>
                <td>${log.note}</td>
            </tr>`;
            tbody.innerHTML += row;
        });

        showScreen('report');
    }
</script>

</body>
</html>